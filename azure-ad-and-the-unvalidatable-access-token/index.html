<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.57b5bc196a71aeb7d3d7.css">@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:300;src:local("Open Sans Light "),local("Open Sans-Light"),url(/static/open-sans-latin-300-60c866748ff15f5b347fdba64596b1b1.woff2) format("woff2"),url(/static/open-sans-latin-300-521d17bc9f3526c690e8ada6eee55bec.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:300;src:local("Open Sans Light italic"),local("Open Sans-Lightitalic"),url(/static/open-sans-latin-300italic-06bbd3188b34820cd83a0e0b3d0a6f57.woff2) format("woff2"),url(/static/open-sans-latin-300italic-8a648ff38ded89ea15916e84529d62d3.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:400;src:local("Open Sans Regular "),local("Open Sans-Regular"),url(/static/open-sans-latin-400-cffb686d7d2f4682df8342bd4d276e09.woff2) format("woff2"),url(/static/open-sans-latin-400-bf2d0783515b7d75c35bde69e01b3135.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:400;src:local("Open Sans Regular italic"),local("Open Sans-Regularitalic"),url(/static/open-sans-latin-400italic-987032ea5d57c93d8da215678eae3b86.woff2) format("woff2"),url(/static/open-sans-latin-400italic-db70d0b9cb27ada1a260a2b35e756b8b.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:600;src:local("Open Sans SemiBold "),local("Open Sans-SemiBold"),url(/static/open-sans-latin-600-223a277bd88d8a90c8cdf24cda0ad5f5.woff2) format("woff2"),url(/static/open-sans-latin-600-1cd5320f8937d337b61d5117cf9d7b28.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:600;src:local("Open Sans SemiBold italic"),local("Open Sans-SemiBolditalic"),url(/static/open-sans-latin-600italic-4950a7205f0b5cefe41fc03ac346e236.woff2) format("woff2"),url(/static/open-sans-latin-600italic-318ea1ada4102c0704a0637228dcad03.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:700;src:local("Open Sans Bold "),local("Open Sans-Bold"),url(/static/open-sans-latin-700-d08c09f2f169f4a6edbcf8b8d1636cb4.woff2) format("woff2"),url(/static/open-sans-latin-700-623e3205570002af47fc2b88f9335d19.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:700;src:local("Open Sans Bold italic"),local("Open Sans-Bolditalic"),url(/static/open-sans-latin-700italic-c02f5da6e82e1efe0b45841bfd49ce37.woff2) format("woff2"),url(/static/open-sans-latin-700italic-72e19cbb0e38c6773a7751156752cec4.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:800;src:local("Open Sans ExtraBold "),local("Open Sans-ExtraBold"),url(/static/open-sans-latin-800-aaeffaf205b9bbb09920089a14dbe9e8.woff2) format("woff2"),url(/static/open-sans-latin-800-c6aa0c4a601fb6ac66f8253fa594dff5.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:800;src:local("Open Sans ExtraBold italic"),local("Open Sans-ExtraBolditalic"),url(/static/open-sans-latin-800italic-6b3973ffe02bb6a8be0f8453506ec032.woff2) format("woff2"),url(/static/open-sans-latin-800italic-79b58175343190550489efe46a7f1138.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;text-shadow:0 1px #fff}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}.token.punctuation{color:#999}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.15.28"/><style id="__jsx-4192424678">.item.jsx-4192424678,.showItem.jsx-4192424678{background:transparent;-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.item.jsx-4192424678 a,.showItem.jsx-4192424678 a{padding:10px;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.item.jsx-4192424678 svg,.showItem.jsx-4192424678 svg{margin:0 5px 0 0;opacity:0.3;}
.itemList .hideItem{display:none;}
@media screen and (min-width:1024px){.item.jsx-4192424678 a{color:#3e3e3c;padding:10px;-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;border-radius:5px;}.homepage:not(.fixed) .item.jsx-4192424678 a{color:#ffffff;}.item.jsx-4192424678 a:hover{color:#709425;background:rgba(255,255,255,0.4);}.item.jsx-4192424678 svg{-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;}.item.jsx-4192424678:hover svg{fill:#709425;opacity:1;}.hero .item.jsx-4192424678:hover svg svg{fill:green;}.showItem.jsx-4192424678{display:none;}.hiddenItem.jsx-4192424678{text-align:left;padding:5px;}.hiddenItem.jsx-4192424678 a.inHiddenItem{color:#3e3e3c;}.hiddenItem.jsx-4192424678 a.inHiddenItem:hover{color:#709425;}}</style><style id="__jsx-1665230755">.menu.jsx-1665230755{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:#ffffff;bottom:0;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex-positive:1;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;left:0;max-height:50px;padding:0 10px;position:fixed;width:100%;z-index:1;-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;}
.itemList.jsx-1665230755{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;list-style:none;margin:0;padding:0;position:relative;width:100%;}
@media screen and (max-width:1023px){.menu.jsx-1665230755::after{position:absolute;content:"";left:20px;right:20px;top:0;height:1px;background:#709425;}.menu.open.jsx-1665230755{padding:20px;}.homepage:not(.fixed) .menu.jsx-1665230755{bottom:-100px;}}
@media screen and (min-width:1024px){.menu.jsx-1665230755{border-top:none;background:transparent;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;padding-left:50px;-webkit-transition:none;-webkit-transition:none;transition:none;}.itemList.jsx-1665230755{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;padding:0;}.hiddenItemList.jsx-1665230755{list-style:none;margin:0;position:absolute;background:#ffffff;border:1px solid #ecebea;top:48px;right:10px;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;padding:20px;border-radius:5px;border-top-right-radius:0;}.hiddenItemList.jsx-1665230755:after{content:"";background:#ffffff;z-index:10;top:-10px;right:-1px;width:44px;height:10px;position:absolute;border-left:1px solid #ecebea;border-right:1px solid #ecebea;}.homepage:not(.fixed) .hiddenItemList.jsx-1665230755{border:1px solid transparent;background:rgba(255,255,255,0.9);top:50px;}.homepage:not(.fixed) .hiddenItemList.jsx-1665230755:after{top:-11px;border-left:1px solid transparent;border-right:1px solid transparent;background:rgba(255,255,255,0.9);}.fixed .hiddenItemList.jsx-1665230755{top:44px;}}</style><style id="__jsx-3380372682">.header.jsx-3380372682{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#ffffff;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:80px;position:relative;top:0;width:100%;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.header.jsx-3380372682 a.logoType{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:"column";-webkit-flex-direction:"column";-ms-flex-direction:"column";flex-direction:"column";color:#3e3e3c;}
.header.jsx-3380372682 a.logoType .logo.jsx-3380372682{-ms-flex-negative:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}
.header.homepage.jsx-3380372682{position:absolute;background-color:transparent;height:100px;;}
h1.jsx-3380372682{font-size:1.22em;font-weight:400;margin:0 0 5px 0;}
h2.jsx-3380372682{font-weight:400;font-size:.72em;-webkit-letter-spacing:0;-moz-letter-spacing:0;-ms-letter-spacing:0;letter-spacing:0;margin:0;}
.logo.jsx-3380372682{border-radius:65% 75%;border:1px solid #eee;display:inline-block;height:44px;margin:0 20px 0 0;overflow:hidden;width:44px;-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;}
.homepage.jsx-3380372682 .logo.jsx-3380372682{height:60px;width:60px;}
.logo.jsx-3380372682 img.jsx-3380372682{width:100%;}
.sensor.jsx-3380372682{display:block;position:absolute;bottom:0;z-index:1;left:0;right:0;height:1px;top:80px;}
@media screen and (min-width:600px){.header.jsx-3380372682{padding:40px;}.header.homepage.jsx-3380372682{height:100px;;}}
@media screen and (max-width:1023px){.header.homepage.jsx-3380372682 .logo.jsx-3380372682{border:none;}.header.homepage.jsx-3380372682 a.logoType,.header.homepage.jsx-3380372682 h1.jsx-3380372682{color:#ffffff;}.header.homepage.jsx-3380372682 h2.jsx-3380372682{color:#dddbda;}}
@media screen and (min-width:1024px){.header.jsx-3380372682{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:#ffffff;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:absolute;top:0;width:100%;-webkit-box-pack:justify;-ms-flex-pack:justify;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-transition:padding 0.5s;-webkit-transition:padding 0.5s;transition:padding 0.5s;}.header.fixed.jsx-3380372682{height:50px;;background-color:#ffffff;left:0;padding:0 20px;position:fixed;top:0;width:100%;z-index:1;}.header.fixed.jsx-3380372682 h1.jsx-3380372682{margin:0 0 2px 0;}.header.fixed.jsx-3380372682 h2.jsx-3380372682{display:none;}.header.homepage.jsx-3380372682:not(.fixed) a.logoType,.header.homepage.jsx-3380372682:not(.fixed) h1.jsx-3380372682{color:#ffffff;}.header.homepage.jsx-3380372682:not(.fixed) h2.jsx-3380372682{color:#dddbda;}.header.jsx-3380372682 a.logoType{text-align:left;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-ms-flex-negative:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:auto;}.logo.jsx-3380372682{margin:0 20px 0 0;}.fixed.jsx-3380372682 .logo.jsx-3380372682{height:36px;width:36px;}.header.homepage.jsx-3380372682:not(.fixed) .logo.jsx-3380372682{border:none;}h2.jsx-3380372682{-webkit-animation-duration:0.5s;-webkit-animation-duration:0.5s;animation-duration:0.5s;-webkit-animation-name:h2Entry;-webkit-animation-name:h2Entry-jsx-3380372682;animation-name:h2Entry-jsx-3380372682;}@-webkit-keyframes h2Entry{from.jsx-3380372682{opacity:0;}to.jsx-3380372682{opacity:1;}}@-webkit-keyframes h2Entry-jsx-3380372682{from{opacity:0;}to{opacity:1;}}@keyframes h2Entry-jsx-3380372682{from{opacity:0;}to{opacity:1;}}}</style><style id="__jsx-3317733201">h1.jsx-3317733201{font-size:1.98em;margin:0 0 40px 0;-webkit-animation-name:headlineEntry;-webkit-animation-name:headlineEntry-jsx-3317733201;animation-name:headlineEntry-jsx-3317733201;-webkit-animation-duration:1s;-webkit-animation-duration:1s;animation-duration:1s;}
h1.jsx-3317733201 span{font-weight:400;display:block;font-size:0.5em;-webkit-letter-spacing:0;-moz-letter-spacing:0;-ms-letter-spacing:0;letter-spacing:0;margin:0 0 5px 0;}
h1.jsx-3317733201 svg{height:0.75em;fill:#709425;}
@-webkit-keyframes headlineEntry{from.jsx-3317733201{opacity:0.5;}to.jsx-3317733201{opacity:1;}}
@-webkit-keyframes headlineEntry-jsx-3317733201{from{opacity:0.5;}to{opacity:1;}}
@keyframes headlineEntry-jsx-3317733201{from{opacity:0.5;}to{opacity:1;}}
@media screen and (min-width:600px){h1.jsx-3317733201{font-size:calc(1.8em * 1.2);}}
@media screen and (min-width:1024px){h1.jsx-3317733201{font-size:calc(1.8em * 1.4);}}</style><style id="__jsx-2703193364">.meta.jsx-2703193364{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;font-size:0.8em;margin:20px 0;background:transparent;}
.meta.jsx-2703193364 svg{fill:#709425;margin:0 5px 0 0;}
.meta.jsx-2703193364 span.jsx-2703193364{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;text-transform:uppercase;margin:5px 10px 5px 0;}
@media screen and (min-width:600px){.meta.jsx-2703193364{margin:calc(20px * 1.5) 0 20px;}}</style><style id="__jsx-2950057177">.bodytext.jsx-2950057177{-webkit-animation-name:bodytextEntry;-webkit-animation-name:bodytextEntry-jsx-2950057177;animation-name:bodytextEntry-jsx-2950057177;-webkit-animation-duration:1s;-webkit-animation-duration:1s;animation-duration:1s;}
.bodytext.jsx-2950057177 h2,.bodytext.jsx-2950057177 h3{margin:1.5em 0 1em;}
.bodytext.jsx-2950057177 h2{line-height:1.2;font-size:1.53em;}
.bodytext.jsx-2950057177 h3{font-size:1.22em;line-height:1.3;}
.bodytext.jsx-2950057177 blockquote{font-style:italic;font-size:1.22em;margin:0 2em;}
.bodytext.jsx-2950057177 p{font-size:1em;line-height:1.6;margin:0 0 1.5em;}
.bodytext.jsx-2950057177 ul{list-style:circle;padding:0 0 0 2em;}
.bodytext.jsx-2950057177 ol{padding:0 0 0 2em;}
.bodytext.jsx-2950057177 li{margin:0.7em 0;line-height:1.5;}
.bodytext.jsx-2950057177 a{font-weight:600;color:#709425;-webkit-text-decoration:underline;text-decoration:underline;}
.bodytext.jsx-2950057177 a.gatsby-resp-image-link{border:0;display:block;margin:1.5em 0 0.5em 0;border-radius:10px;overflow:hidden;border:1px solid #ecebea;}
.bodytext.jsx-2950057177 span.caption{font-size:.86em;font-style:italic;display:table;margin:0 auto;}
@-webkit-keyframes bodytextEntry{from.jsx-2950057177{opacity:0;}to.jsx-2950057177{opacity:1;}}
@-webkit-keyframes bodytextEntry-jsx-2950057177{from{opacity:0;}to{opacity:1;}}
@keyframes bodytextEntry-jsx-2950057177{from{opacity:0;}to{opacity:1;}}</style><style id="__jsx-646394116">.author.jsx-646394116{margin:40px 0;padding:40px 0;border-top:1px solid #ecebea;border-bottom:1px solid #ecebea;}
.avatar.jsx-646394116{float:left;border-radius:65% 75%;border:1px solid #ecebea;display:inline-block;height:50px;margin:5px 20px 0 0;overflow:hidden;width:50px;}
.avatar.jsx-646394116 img.jsx-646394116{width:100%;}
.note.jsx-646394116{font-size:0.9em;line-height:1.6;}
@media screen and (min-width:600px){.author.jsx-646394116{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.avatar.jsx-646394116{-webkit-box-flex:0;-ms-flex:0 0 auto;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;}}</style><style id="__jsx-126278577">.links.jsx-126278577{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:0 20px 40px;border-bottom:1px solid #ecebea;margin:0 0 40px 0;}
.links.jsx-126278577 a{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}
.links.jsx-126278577 a:nth-child(2){margin:20px 0 0;}
.links.jsx-126278577 svg{fill:orange;width:20px;height:20px;-ms-flex-negative:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-box-flex:0;-ms-flex-positive:0;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;margin:0 20px 0 0;}
h4.jsx-126278577{font-weight:600;margin:0;font-size:1.1em;}
time.jsx-126278577{color:#969492;display:block;font-weight:400;font-size:0.8em;margin-top:0.5em;}
@media screen and (min-width:1024px){.links.jsx-126278577{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;-webkit-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}.links.jsx-126278577 a{-ms-flex-preferred-size:50%;-webkit-flex-basis:50%;-ms-flex-preferred-size:50%;flex-basis:50%;}.links.jsx-126278577 a:nth-child(2){margin:0;}.links.jsx-126278577 svg{-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;margin:0 10px 0 0;}@media (hover:hover){.links.jsx-126278577 a:hover svg{-webkit-transform:scale(1.5);-webkit-transform:scale(1.5);-ms-transform:scale(1.5);transform:scale(1.5);}}}</style><style id="__jsx-4024790327">.article.jsx-4024790327{padding:20px;margin:0 auto;}
@media screen and (min-width:600px){.article.jsx-4024790327{padding:calc(20px) calc(20px * 2);max-width:650px;}}
@media screen and (min-width:1024px){.article.jsx-4024790327{padding:calc(20px * 2 + 90px) 0 calc(20px * 2);max-width:700px;}}</style><style id="__jsx-2880174640">.footer.jsx-2880174640{background:#ffffff;padding:20px;padding-top:0;padding-bottom:120px;}
.footer.jsx-2880174640 ul{list-style:none;text-align:center;padding:0;}
.footer.jsx-2880174640 ul li{color:#969492;font-size:.72em;padding:2px 10px;position:relative;display:inline-block;}
.footer.jsx-2880174640 ul li::after{content:"•";position:absolute;right:calc(5px * -1);}
.footer.jsx-2880174640 ul li:last-child::after{content:"";}
@media screen and (min-width:1024px){.footer.jsx-2880174640{padding:0 1em 1.5em;}}</style><style id="__jsx-3017011455">main.jsx-3017011455{min-height:80vh;}</style><style id="__jsx-3148707342">html{-webkit-box-sizing:border-box;box-sizing:border-box;}
*,*:after,*:before{-webkit-box-sizing:inherit;box-sizing:inherit;margin:0;padding:0;}
body{font-family:Arial, sans-serif;;}
h1,h2,h3{font-weight:400;line-height:1.1;-webkit-letter-spacing:-0.03em;-moz-letter-spacing:-0.03em;-ms-letter-spacing:-0.03em;letter-spacing:-0.03em;margin:0;}
h1{-webkit-letter-spacing:-0.04em;-moz-letter-spacing:-0.04em;-ms-letter-spacing:-0.04em;letter-spacing:-0.04em;}
p{margin:0;}
strong{font-weight:400;}
a{-webkit-text-decoration:none;text-decoration:none;color:#666;}
main{width:auto;display:block;}</style><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-b3b573358bfc66d89e1e95dbf8319c09.css"/><title data-react-helmet="true">Azure AD and the Un-validatable Access Token - Anthony Attwood</title><meta data-react-helmet="true" name="description" content="Anthony Attwood personal blog"/><meta data-react-helmet="true" property="og:url" content="https://tonesandtones.github.ioundefined/azure-ad-and-the-unvalidatable-access-token/"/><meta data-react-helmet="true" property="og:title" content="Azure AD and the Un-validatable Access Token - Anthony Attwood"/><meta data-react-helmet="true" property="og:description" content="Anthony Attwood personal blog"/><meta data-react-helmet="true" property="og:image" content="[object Object]"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="fb:app_id" content=""/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="tonesattwood"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#666"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-8e4f872f53c8fce41965.js"/><link as="script" rel="preload" href="/app-1e1babc26f286c18c6f3.js"/><link as="script" rel="preload" href="/commons-e2b9e4157a7531f6338b.js"/><link as="script" rel="preload" href="/styles-1a7f296c716d809c8bcf.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-48724be4b07ab3351423.js"/><link as="fetch" rel="preload" href="/page-data/azure-ad-and-the-unvalidatable-access-token/page-data.json" crossorigin="anonymous"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#D0E0D8"/><meta name="apple-mobile-web-app-title" content="Lazywill"/><link rel="apple-touch-icon" href="/icons/apple-icon-57x57.png" sizes="57x57"/><link rel="apple-touch-icon" href="/icons/apple-icon-60x60.png" sizes="60x60"/><link rel="apple-touch-icon" href="/icons/apple-icon-72x72.png" sizes="72x72"/><link rel="apple-touch-icon" href="/icons/apple-icon-76x76.png" sizes="76x76"/><link rel="apple-touch-icon" href="/icons/apple-icon-114x114.png" sizes="114x114"/><link rel="apple-touch-icon" href="/icons/apple-icon-120x120.png" sizes="120x120"/><link rel="apple-touch-icon" href="/icons/apple-icon-144x144.png" sizes="144x144"/><link rel="apple-touch-icon" href="/icons/apple-icon-152x152.png" sizes="152x152"/><link rel="apple-touch-icon" href="/icons/apple-icon-180x180.png" sizes="180x180"/><link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><header class="jsx-3380372682 header  "><a class="logoType" href="/"><div class="jsx-3380372682 logo"><img src="/static/avatar-1e6131826211961d584792171e4f1121.jpg" alt="Anthony Attwood - Punny Blog" class="jsx-3380372682"/></div><div class="jsx-3380372682 type"><h1 class="jsx-3380372682">anthony attwood</h1><h2 class="jsx-3380372682">&lt;&lt; punny blog name goes here &gt;&gt;</h2></div></a><nav rel="js-menu" class="jsx-1665230755 menu "><ul class="jsx-1665230755 itemList"><li class="jsx-4192424678 item"><a class="" data-slug="/" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg> <!-- -->Home</a></li><li class="jsx-4192424678 item"><a class="" data-slug="/category/" href="/category/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg> <!-- -->Categories</a></li><li class="jsx-4192424678 item"><a class="" data-slug="/search/" href="/search/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg> <!-- -->Search</a></li><li class="jsx-4192424678 item"><a class="" data-slug="/about/" href="/about/"> <!-- -->About</a></li></ul></nav></header><div class="jsx-3380372682 sensor"></div><main class="jsx-3017011455 jsx-3148707342"><article class="jsx-4024790327 article"><header><h1 class="jsx-3317733201">Azure AD and the Un-validatable Access Token</h1><p class="jsx-2703193364 meta"><span class="jsx-2703193364"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" size="18" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></svg> <!-- -->2020-02-25</span><span class="jsx-2703193364"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" size="18" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></svg> <!-- -->Anthony Attwood</span><span class="jsx-2703193364"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" size="18" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg><a href="/category/authentication">authentication</a></span></p></header><div class="jsx-2950057177 bodytext"><p>On any project with a backend API, you probably want to secure access to that API so that only authenticated users can call it. If you’re wanting to authenticate users that already exist in an Azure Active Directory tenant, then an Azure AD App Registration will probably be involved.</p>
<p>This post aims to explain a major gotchya with using an Azure AD App Registration for securing access to an API, and assumes you’re reasonably familiar with modern authentication using OAuth and OIDC. In particular, the idea of acquiring an access token for a particular api (or “audience” in OAuth terms).</p>
<p><em>Inspired by <a href="https://stackoverflow.com/questions/45317152/invalid-signature-while-validating-azure-ad-access-token-but-id-token-works">this SO post</a> and a <a href="https://github.com/AzureAD/azure-activedirectory-identitymodel-extensions-for-dotnet/issues/609">related Github issue</a></em></p>
<h2>tl;dr</h2>
<p>To get the Microsoft Identity Platform to issue access tokens you can pass to <em>your</em> api, you <em>need</em> to set up a custom scope in the App Registration’s <em>Expose an API</em> tab, and request that scope when you acquire the tokens. If you don’t, you will get access tokens that are intended to be presented to the Microsoft Graph API and cannot be validated by vanilla JWT middleware.</p>
<h2>… continued …</h2>
<p>If you’re reasonably familiar with OAuth and OIDC, you might think that it’s straightforward to;</p>
<ul>
<li>set up an App Registration in Azure AD,</li>
<li>implement a login flow using your chosen authentication flow using the App Registration’s client id,</li>
<li>request an access token via the <code class="language-text">/token</code> endpoint, and lastly,</li>
<li>present the access token to your api (usually as an <code class="language-text">Authorization: Bearer {access_token}</code> header)</li>
</ul>
<p>Your API will then validate the token, ensure the subject represented by the token is allowed to access the desired resource, and execute the API call.</p>
<h2>Gotchya</h2>
<p>…And your API won’t be able to validate the token.</p>
<p>The App Registration blade in the Azure Portal has a tab called <em>Expose an API</em>.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/80902ffb395d87dea4c391b24dc267f2/ed731/app-registration-api-no-scope.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 48.85807504078304%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAACE3AAAhNwEzWJ96AAABh0lEQVQoz4VRTW/UMBDNb+fChRN/gxsSpT2AkDhSFs5EFSq7qLsbJ/6IHTt2xo+xN90WpFJLTzP+mJn3npufd7J9++6qvXh/2V5cXv368PGT2u22N8Mg2pRiG+MJy7K0Oedn0cwLQJTxeN3vlLL4cr3B5tt3XH/dYJo8nlvNOFrSWlPOtS3N003ubl+S2L6i4fdrsmZPzgUyxpD3nmJMlFLiGCmteYnMjrgfNQepIHrBtE68YvQ47Fsc7n5ADltIOUDxGyUltNIIIYAbw08Tgg91X5DX+sbx5fEoYa2vh+wV+l5h5D2nDzbwnXOOZU+1wTiOXGPX3JzzJgSJoS9sdjw5sJ8L5nVqYXKanGskooqi7iFfz3l6ic3++Aa72xcw6jNLSJicRdd1PGCAED2cdYhz5CEz5vlplGZVsjCuSnTOV0ZsdvWrSDJaV7aloPhV7u89+xfnhtqMGJiNMbr6tyyJmXUYjWF29q/H/KN14FOryK+fIoRgNubsR5EXVmaFVWn02Lf/4Q9y9AMz1l+ltwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="App Registration blade - Expose an API  - no scopes"
        title=""
        src="/static/80902ffb395d87dea4c391b24dc267f2/8ff1e/app-registration-api-no-scope.png"
        srcset="/static/80902ffb395d87dea4c391b24dc267f2/9ec3c/app-registration-api-no-scope.png 200w,
/static/80902ffb395d87dea4c391b24dc267f2/c7805/app-registration-api-no-scope.png 400w,
/static/80902ffb395d87dea4c391b24dc267f2/8ff1e/app-registration-api-no-scope.png 800w,
/static/80902ffb395d87dea4c391b24dc267f2/6ff5e/app-registration-api-no-scope.png 1200w,
/static/80902ffb395d87dea4c391b24dc267f2/ed731/app-registration-api-no-scope.png 1226w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>When I first encountered this issue, I didn’t set up any scopes for my API because I thought;</p>
<blockquote>
<p>“This only lets me set up scopes - my API doesn’t need any scopes, I only want the verified subject details of a logged in user, which I can get from an access token”</p>
</blockquote>
<h2>So what do you actually get?</h2>
<p>If you go through a login flow and acquire an id and access token with the App Registration set up like this, you’ll get an (decoded) id token that looks like something like this;</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">ID Token

Header
<span class="token punctuation">{</span>
  <span class="token property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span><span class="token punctuation">,</span>
  <span class="token property">"alg"</span><span class="token operator">:</span> <span class="token string">"RS256"</span><span class="token punctuation">,</span>
  <span class="token property">"kid"</span><span class="token operator">:</span> <span class="token string">"HlC0R**snip**"</span>
<span class="token punctuation">}</span>

Payload
<span class="token punctuation">{</span>
  <span class="token property">"aud"</span><span class="token operator">:</span> <span class="token string">"{app-registration-client-id}"</span><span class="token punctuation">,</span>
  <span class="token property">"iss"</span><span class="token operator">:</span> <span class="token string">"https://login.microsoftonline.com/{azure-ad-tenant-id}/v2.0"</span><span class="token punctuation">,</span>
  <span class="token property">"iat"</span><span class="token operator">:</span> <span class="token number">1582618197</span><span class="token punctuation">,</span>
  <span class="token property">"nbf"</span><span class="token operator">:</span> <span class="token number">1582618197</span><span class="token punctuation">,</span>
  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1582622097</span><span class="token punctuation">,</span>
  <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"anthony.attwood@****"</span><span class="token punctuation">,</span>
  <span class="token property">"nonce"</span><span class="token operator">:</span> <span class="token string">"{nonce-value}"</span><span class="token punctuation">,</span>
  <span class="token property">"preferred_username"</span><span class="token operator">:</span> <span class="token string">"anthony.attwood@***"</span><span class="token punctuation">,</span>
  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"{subject-id}"</span><span class="token punctuation">,</span>
  <span class="token property">"ver"</span><span class="token operator">:</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span>
  <span class="token property">"**lots-more-claims**"</span><span class="token operator">:</span> <span class="token string">"**snip**"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Nothing particularly unexpected in the id token.</p>
<p>The access token on the other hand… When decoded it’ll look something like this;</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">Access Token

Header
<span class="token punctuation">{</span>
  <span class="token property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span><span class="token punctuation">,</span>
  <span class="token property">"nonce"</span><span class="token operator">:</span> <span class="token string">"ekY15jb**snip**"</span><span class="token punctuation">,</span>
  <span class="token property">"alg"</span><span class="token operator">:</span> <span class="token string">"RS256"</span><span class="token punctuation">,</span>
  <span class="token property">"x5t"</span><span class="token operator">:</span> <span class="token string">"HlC0R**snip**"</span><span class="token punctuation">,</span>
  <span class="token property">"kid"</span><span class="token operator">:</span> <span class="token string">"HlC0R**snip**"</span>
<span class="token punctuation">}</span>

Payload
<span class="token punctuation">{</span>
  <span class="token property">"aud"</span><span class="token operator">:</span> <span class="token string">"00000003-0000-0000-c000-000000000000"</span><span class="token punctuation">,</span>
  <span class="token property">"iss"</span><span class="token operator">:</span> <span class="token string">"https://sts.windows.net/{azure-ad-tenant-id}/"</span><span class="token punctuation">,</span>
  <span class="token property">"iat"</span><span class="token operator">:</span> <span class="token number">1582618197</span><span class="token punctuation">,</span>
  <span class="token property">"nbf"</span><span class="token operator">:</span> <span class="token number">1582618197</span><span class="token punctuation">,</span>
  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1582622097</span><span class="token punctuation">,</span>
  <span class="token property">"app_displayname"</span><span class="token operator">:</span> <span class="token string">"{app-registration-name}"</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Anthony Attwood"</span><span class="token punctuation">,</span>
  <span class="token property">"scp"</span><span class="token operator">:</span> <span class="token string">"User.Read profile openid email"</span><span class="token punctuation">,</span>
  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"{different-sub-claim-to-the-id-token}"</span><span class="token punctuation">,</span>
  <span class="token property">"unique_name"</span><span class="token operator">:</span> <span class="token string">"anthony.attwood@***"</span><span class="token punctuation">,</span>
  <span class="token property">"upn"</span><span class="token operator">:</span> <span class="token string">"anthony.attwood@***"</span><span class="token punctuation">,</span>
  <span class="token property">"**lots-more-claims**"</span><span class="token operator">:</span> <span class="token string">"**snip**"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Your API won’t be able to validate the access token, indeed, there’s a couple of things wrong with it if you intend to present it to <em>your own</em> api.</p>
<ul>
<li>The header has a <code class="language-text">nonce</code> parameter. This breaks validation and is indeed what the SO post I mentioned at the start of the article is about. A regular JWT does not have a <code class="language-text">nonce</code> parameter in the header.</li>
<li>The <code class="language-text">aud</code> claim (“aud” = audience) is a weird looking GUID that’s mostly zero’s, <code class="language-text">00000003-0000-0000-c000-000000000000</code>. You’d probably expect it to be your App Registrations client id.</li>
</ul>
<p>The funny looking <code class="language-text">aud</code> claim indicates that the access token is actually intended to be presented to the Microsoft Graph API, <em>not</em> your API. The Graph API knows how to validate that kind of token.</p>
<h2>The missing piece of the puzzle</h2>
<p>Remember the <em>Expose an API</em> tab where I didn’t set up any scopes? This is the missing piece of the puzzle.</p>
<p>Even if your API doesn’t need any custom scopes — remember, your API might only care about knowing that the token was issued to a known logged in user — you still need to set up a custom scope and request it in your <code class="language-text">/token</code> or <code class="language-text">/authorize</code> request.</p>
<p>Set up a custom scope in the <em>Expose an API</em> tab, and you’ll see your new scope in the list, which will always be prefixed with your <code class="language-text">Application ID URI</code>.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/03ca397605f5f1b3be88b00ff26d0077/c6f47/app-registration-api-with-scope.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 47.13275726630008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAACE3AAAhNwEzWJ96AAABUklEQVQoz5VSbU7DMAzN/e8EmgbcAMEBGO3Wds1nmzRNbGxv3Qb/iPRkJ7Gfn52or841u/2b27+82qfn3fH947M5dV2jrW3yWppcSlMqECr59er/AdyhUl4RasXHta4rEgFmsv9dylgH3gfirFABwIcA3fEEfdeD1hqC9+CcE8zzDDFGmMIE8eqz5UVcgGTV2Xl0BJQTxDlGHPoevfdICThNExIR2fmivBSxm88gMXjhJIUxTdgTQQgB+SymBZ21uCwLFkraAnlxjKU7LjKOIwlxsjfGyB0TK02b78MBx/NZlCQi4gRWuAUxKSPnjJnuWV1KSSwX3iCE3WikRZoFHSbU2iDND4dhQE0qmFwQJhkBgwvf7Bx/daFG60U+K6JvIgqtNdIKq9jUcfW85Jv/iC2GoSzNoW1btNQ6yqMkUcbtcpGZHoMDefjc1mPyHVW+HuMHBCm6nEd2LCUAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"
        alt="App Registration blade - Expose an API  - with scope"
        title=""
        src="/static/03ca397605f5f1b3be88b00ff26d0077/8ff1e/app-registration-api-with-scope.png"
        srcset="/static/03ca397605f5f1b3be88b00ff26d0077/9ec3c/app-registration-api-with-scope.png 200w,
/static/03ca397605f5f1b3be88b00ff26d0077/c7805/app-registration-api-with-scope.png 400w,
/static/03ca397605f5f1b3be88b00ff26d0077/8ff1e/app-registration-api-with-scope.png 800w,
/static/03ca397605f5f1b3be88b00ff26d0077/6ff5e/app-registration-api-with-scope.png 1200w,
/static/03ca397605f5f1b3be88b00ff26d0077/c6f47/app-registration-api-with-scope.png 1273w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<h2>Now does it work?</h2>
<p>Now when you acquire an access token, you request your special scope, and you’ll get back an access token in a different format that you can safely pass to your API.</p>
<p>For simplicity and for when I don’t have a UI hooked up to do an interactive flow, I use an implicit flow to get tokens. So using a call to the <code class="language-text">/token</code>,</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">GET https://login.microsoftonline.com/{tenant-id}/oauth2/v2.0/authorize /
  ?scope=api://thisismyappid/SuperSpecialScope profile email openid /
  &amp;response_type=id_token token /
  &amp;client_id={client-id} /
  &amp;redirect_uri={some-imaginary-but-valid-redirect-uri} /
  &amp;nonce={anything} /
  &amp;state={anything}</code></pre></div>
<p>Notice the scopes I’m requesting include the scope I just set up in the <em>Expose an API</em> tab.</p>
<p>You get back an id token that still looks like it did before, but the access token looks different.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">Access Token

Header
<span class="token punctuation">{</span>
  <span class="token property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span><span class="token punctuation">,</span>
  <span class="token property">"alg"</span><span class="token operator">:</span> <span class="token string">"RS256"</span><span class="token punctuation">,</span>
  <span class="token property">"x5t"</span><span class="token operator">:</span> <span class="token string">"HlC0RHlC0R**snip**"</span><span class="token punctuation">,</span>
  <span class="token property">"kid"</span><span class="token operator">:</span> <span class="token string">"HlC0RHlC0R**snip**"</span>
<span class="token punctuation">}</span>

Payload
<span class="token punctuation">{</span>
  <span class="token property">"aud"</span><span class="token operator">:</span> <span class="token string">"api://thisismyappid"</span><span class="token punctuation">,</span>
  <span class="token property">"iss"</span><span class="token operator">:</span> <span class="token string">"https://sts.windows.net/{azure-ad-tenant-id}/"</span><span class="token punctuation">,</span>
  <span class="token property">"iat"</span><span class="token operator">:</span> <span class="token number">1582620705</span><span class="token punctuation">,</span>
  <span class="token property">"nbf"</span><span class="token operator">:</span> <span class="token number">1582620705</span><span class="token punctuation">,</span>
  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1582624605</span><span class="token punctuation">,</span>
  <span class="token property">"appid"</span><span class="token operator">:</span> <span class="token string">"{client-id}"</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Anthony Attwood"</span><span class="token punctuation">,</span>
  <span class="token property">"scp"</span><span class="token operator">:</span> <span class="token string">"SuperSpecialScope"</span><span class="token punctuation">,</span>
  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"{same-sub-as-the-id-token}"</span><span class="token punctuation">,</span>
  <span class="token property">"unique_name"</span><span class="token operator">:</span> <span class="token string">"anthony.attwood@***"</span><span class="token punctuation">,</span>
  <span class="token property">"upn"</span><span class="token operator">:</span> <span class="token string">"anthony.attwood@***"</span><span class="token punctuation">,</span>
  <span class="token property">"**lots-more-claims**"</span><span class="token operator">:</span> <span class="token string">"**snip**"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>A few things to notice about this new format of access token include;</p>
<ul>
<li>There’s no <code class="language-text">nonce</code> parameter in the header</li>
<li>The audience <code class="language-text">aud</code> claim is now what we’ve configured in the App Registration as the <em>App Id URI</em>, not the special GUID that represents the Graph API</li>
</ul>
<p>This token will validate correctly using the JWKS signing material we can discover from the OpenIDConnect discovery document. We can get that by appending <code class="language-text">/.well-known/openid-configuration</code> to the value of the issuer <code class="language-text">iss</code> claim, for example, <code class="language-text">https://sts.windows.net/{azure-ad-tenant-id}/.well-known/openid-configuration</code>. Your JWT validation middleware probably does this for you automatically based on the value of the <code class="language-text">iss</code> claim.</p>
<h2>The solution</h2>
<p>By adding a custom claim to the App Registration’s <em>Expose an API</em> tab and requesting that scope when we acquire tokens, the Microsoft Identity Platform will now generate  access tokens that we can present to <em>our</em> API, and that will validate correctly by any compliant JWT middleware.</p>
<p>Happy authenticating!</p></div><footer><div>Loading...</div><div class="jsx-646394116 author"><div class="jsx-646394116 avatar"><img src="/static/avatar-1e6131826211961d584792171e4f1121.jpg" alt="Anthony Attwood - Punny Blog" class="jsx-646394116"/></div><div class="jsx-646394116 note"><p><strong>Anthony Attwood</strong> I’m a consultant software engineer living and working in Perth, Australia, building solutions that solve real problems for customers.</p></div></div><div class="jsx-126278577 links"><a href="/sql-server-express-localdb-jdbc/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></svg><h4 class="jsx-126278577">SQL Server Express LocalDB via JDBC<!-- --> <time class="jsx-126278577">2019-12-11</time></h4></a></div></footer></article></main><footer class="jsx-2880174640 footer"><ul>
<li>I work for <a href="https://purple.telstra.com">Telstra Purple</a></li>
<li>Hosted by <a href="https://pages.github.com/">Github Pages</a></li>
<li>Powered by <a href="https://www.gatsbyjs.org/">GatsbyJS</a></li>
<li>Photos from <a href="https://unsplash.com/">Unsplash</a></li>
</ul></footer></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/azure-ad-and-the-unvalidatable-access-token/";window.webpackCompilationHash="85011033877159051bae";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-1e1babc26f286c18c6f3.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-e722c0af9a6f821f932a.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-e0bb4db8e52ebc427d86.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-48724be4b07ab3351423.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-6e4ad2b36923b1c93cda.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c5a788d5573b956e885f.js"],"component---src-pages-category-js":["/component---src-pages-category-js-a30cb7955208c1cb96af.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f76074234030ec25b567.js"],"component---src-pages-search-js":["/component---src-pages-search-js-86744d15df69b3f0a459.js"]};/*]]>*/</script><script src="/component---src-templates-post-template-js-48724be4b07ab3351423.js" async=""></script><script src="/styles-1a7f296c716d809c8bcf.js" async=""></script><script src="/commons-e2b9e4157a7531f6338b.js" async=""></script><script src="/app-1e1babc26f286c18c6f3.js" async=""></script><script src="/webpack-runtime-8e4f872f53c8fce41965.js" async=""></script></body></html>